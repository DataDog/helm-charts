variables:
  # Do not modify this - must be the repository name for Kubernetes gitlab runners to run
  KUBERNETES_SERVICE_ACCOUNT_OVERWRITE: helm-charts
e2e:
  #  rules:
  #    - if: $CI_COMMIT_BRANCH == "main"
  image: 486234852809.dkr.ecr.us-east-1.amazonaws.com/ci/test-infra-definitions/runner:a58cc31c
  tags: ["arch:amd64"]
  before_script:
    - apt-get update
    - apt-get install -y jq
    # Setup AWS Credentials
    - mkdir -p ~/.aws
    - set +x
    - aws ssm get-parameter --region us-east-1 --name ci.helm-charts.e2e-sandbox-profile --with-decryption --query "Parameter.Value" --out text >> ~/.aws/config
    - set -x
    - export AWS_PROFILE=helm-charts-e2e-sandbox
    - pulumi login --local
  script:
    - make test-e2e
